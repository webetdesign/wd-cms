{% extends '@SonataAdmin/CRUD/base_list.html.twig' %}

{%- block actions -%}
    <li>
        {% if root %}
            <a class="sonata-action-element sonata-action-element__cms-menu" href="{{ admin.generateUrl('create', {target: root.id}) }}">
                <i class="fa fa-plus-circle" aria-hidden="true"></i>
                {{ 'link_action_create'|trans({}, 'SonataAdminBundle') }}
            </a>
        {% else %}
            <a class="sonata-action-element sonata-action-element__cms-menu" href="{{ path('admin_webetdesign_cms_cmsmenu_createRootNode') }}">
                <i class="fa fa-plus-circle" aria-hidden="true"></i>
                init
            </a>
        {% endif %}
    </li>
{%- endblock -%}

{% block list_table %}
    {% if admin.datagrid.results|length == 0 %}
        <div class="col-xs-12">
            <div class="alert alert-danger" role="alert">
                Aucune configuration détecté, <a href="{{ path('admin_webetdesign_cms_cmsmenu_createRootNode') }}">Initaliser avec le menu par defaut !</a>
            </div>
        </div>
    {% else %}
        <div class="col-xs-6 col-md-6">
            <div class="cmsMenuAdmin" data-move-url="{{ url('admin_webetdesign_cms_cmsmenu_move', [], true) }}">
                {% set items = admin.datagrid.results %}
                {% for item in items if item.lvl == 1 %}
                    <div class="box box-primary">
                        <div class="box-header item-data" data-id="{{ item.id }}" data-edit-url="{{ admin.generateUrl('edit', {id: item.id}) }}" data-add-url="{{ admin.generateUrl('create', {target: item.id}) }}">
                            <h4 class="box-title">{{ item.name }} <code>{{ item.code }}</code></h4>
                            <button class="cms-menu-item__btn-edit"><i class="fa fa-pencil"></i></button>
                            <button class="cms-menu-item__btn-add"><i class="fa fa-plus"></i></button>
                        </div>
                        <div class="box-body">
                            {% set menu = knp_menu_get('cmsAdminMenu', [], {code: item.code, admin: admin}) %}
                            {{ knp_menu_render(menu, [], 'cms_menu_admin_renderer') }}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <br><br>
        </div>
        <div class="col-xs-6 col-md-6">
            <div class="spinbox" style="display: none">
                <div class="spinner"></div>
            </div>
            <div class="edit-container" style="display: none">

            </div>
        </div>
    {% endif %}
    <script>

    </script>
{% endblock %}
